{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "planning_input.schema.json",
  "title": "Planning Input Contract",
  "description": "Schema-locked input contract for the planning subsystem. Planning MUST consume only this shape. Discovery output is illegal downstream.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "contract_version",
    "main_map",
    "artifacts",
    "relationships"
  ],
  "properties": {
    "contract_version": {
      "type": "string",
      "const": "planning.input.v1",
      "description": "Fixed contract version. Any other value is invalid."
    },

    "main_map": {
      "type": "string",
      "minLength": 1,
      "description": "Path of the unique MAIN map. Must match exactly one artifact.path where artifact_type == 'map' and classification == 'MAIN'."
    },

    "artifacts": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/planningArtifact"
      },
      "description": "All artifacts participating in planning."
    },

    "relationships": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/planningRelationship"
      },
      "description": "All relationships planning is allowed to reason about."
    }
  },

  "definitions": {
    "planningArtifact": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "path",
        "artifact_type",
        "classification",
        "metadata"
      ],
      "properties": {
        "path": {
          "type": "string",
          "minLength": 1,
          "description": "Relative artifact path inside the package."
        },

        "artifact_type": {
          "type": "string",
          "enum": ["map", "topic", "media"],
          "description": "Restricted artifact types visible to planning."
        },

        "classification": {
          "type": ["string", "null"],
          "description": "Classification produced by discovery. Planning uses this ONLY for selecting main_map."
        },

        "metadata": {
          "type": "object",
          "description": "Opaque metadata preserved from discovery. Planning does not interpret it unless explicitly declared by downstream rules.",
          "additionalProperties": true
        }
      }
    },

    "planningRelationship": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "source",
        "target",
        "type",
        "pattern_id"
      ],
      "properties": {
        "source": {
          "type": "string",
          "minLength": 1,
          "description": "Path of source artifact."
        },

        "target": {
          "type": "string",
          "minLength": 1,
          "description": "Path of target artifact."
        },

        "type": {
          "type": "string",
          "minLength": 1,
          "description": "Relationship semantic type (e.g., 'topicref', 'image')."
        },

        "pattern_id": {
          "type": "string",
          "minLength": 1,
          "description": "Discovery pattern identifier for traceability."
        }
      }
    }
  }
}